{"data":{"site":{"siteMetadata":{"title":"Ashish Dubey's Blog","author":"Ashish Dubey"}},"markdownRemark":{"id":"d0ff3803-9d12-5c2e-a28c-bf1bacd3392c","excerpt":"This post covers an experiment of mine that allows a person to generate music from free-form drawing on a canvas. More than just being about a musical drawing…","html":"<p><em>This post covers an experiment of mine that allows a person to generate music from free-form drawing on a canvas. More than just being about a musical drawing interface, I try to take this project as an example to discuss an electronic musical instrument mapping model that I</em> <em>recently read about. It helped me understand how to think structurally about my experiment and maybe it could help others too.</em></p>\n<h2>About this experiment</h2>\n<p>For a while, I’ve pondered on the idea of generating music out of pictures. Imagining a picture of a seashore, and somehow being able to generate sounds that would be representative of the content in the picture. Since I didn’t have any clue of how I could build it, I carried that idea for a while, until other ideas got built on top ending up simplifying the original idea to an extent.</p>\n<p>In my head, I iterated over something in which I would detect edges in a picture, paint them on a canvas and play notes based on where a rolling playhead intersects an edge on the canvas. Edge detection seemed promising but I imagined that the results could be too random, mostly because the edge detection algorithms might not give the audience the kind of edges they are anticipating. Moreover, whatever output comes out (often undesirable), it would be out of control of the audience. So I thought why not let the audience draw these edges and make the scene look and sound however they want.</p>\n<p>As a result of this train of thoughts, I built a very simple web-based drawing interface that can be used to generate music by drawing free-form shapes on a canvas. Some musical structure is embedded into the interface so that the user doesn’t have to care so much about the musical details and can just focus on sketching.</p>\n<figure>\n    \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 74.81662591687042%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAAB2hJG4Ub/xAAXEAADAQAAAAAAAAAAAAAAAAAAARAR/9oACAEBAAEFAtE6p//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABsQAAIBBQAAAAAAAAAAAAAAAAABERAhMUFh/9oACAEBAAE/Id5J1RZfRLtkn//aAAwDAQACAAMAAAAQ6A//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAXEQEAAwAAAAAAAAAAAAAAAAAAESFB/9oACAECAQE/ELxL/8QAGhAAAwEBAQEAAAAAAAAAAAAAAAEhEUFRcf/aAAgBAQABPxCoOPhpuutfLDXwRJmaFK2v0qs//9k=&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"instrument model\" title=\"\" src=\"/static/4d3f52386abbf124bcaf6daec7b652da/f8fb9/wireframe.jpg\" srcset=\"/static/4d3f52386abbf124bcaf6daec7b652da/e8976/wireframe.jpg 148w,\n/static/4d3f52386abbf124bcaf6daec7b652da/63df2/wireframe.jpg 295w,\n/static/4d3f52386abbf124bcaf6daec7b652da/f8fb9/wireframe.jpg 590w,\n/static/4d3f52386abbf124bcaf6daec7b652da/85e3d/wireframe.jpg 885w,\n/static/4d3f52386abbf124bcaf6daec7b652da/d1924/wireframe.jpg 1180w,\n/static/4d3f52386abbf124bcaf6daec7b652da/9452e/wireframe.jpg 1770w,\n/static/4d3f52386abbf124bcaf6daec7b652da/7859e/wireframe.jpg 3272w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  </span>\n  \n    <font size=\"2\">\n        <figcaption>Initial idea which didn&apos;t change much while hacking it together</figcaption>\n    </font>\n</figure>\n<p>I’d highly recommend playing around with it for a bit <a href=\"https://ashishdubey.xyz/pastelloops\">here</a> before delving into the details in the following sections.</p>\n<h2>Background</h2>\n<p>The intermingling of visual composition and sound has been explored in several contexts for a long time. In the following sections, we’ll discuss these contexts in which artists, musicians and musical instrument makers and researchers have extended their ideas in this domain.</p>\n<h3>In arts</h3>\n<blockquote>\n<p>“One day I must be able to improvise freely on the keyboard of colors: the row of watercolors in my paintbox” - Paul Klee</p>\n</blockquote>\n<p>The ideas like associating shade of color with musical keys among so many others have existed for a long time in arts. Artists like <a href=\"http://www.paul-klee.org/music/\">Paul Klee</a> and <a href=\"https://www.theguardian.com/artanddesign/2006/jun/24/art.art\">Kadinsky</a> have reflected a strong inspiration from music into their art work as paintings. …</p>\n<h3>In experimental music</h3>\n<p>mention painting sound</p>\n<h3>In modern instrument research</h3>\n<h2>Digital instrument mapping</h2>\n<p>Lately, I picked up <a href=\"https://www.bloomsbury.com/uk/sonic-writing-9781501313868/\">Sonic Writing by Thor Magnusson</a> as it seemed like an interesting book for someone who holds the desire to understand what goes behind building an interactive musical experience.</p>\n<p>While going through the instrumentality part of the book, I came across a musical instrument design model which on an abstract level describes components of a digital musical instrument. This seemed like a good way of thinking about my free-form drawing interface as a digital music instrument.</p>\n<figure>\n    \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 60.084477296726504%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABoUlEQVQoz3WSV4sDMQyE/f//U8hzCClk09umZ9N7L7r7BrQPB2cQlm1pNBo52O/6fr/23+JtvV7bbDaz1Wpl7/fbPp9Puv+NDQ7G7kFufn4+n7ZcLu1yudhms7HpdKoCh8MhzXWcFPB6vcpIOh6Pdjqd7PF4yCcRwP1+L380Gon1brfTPT5GfHC6nrxYLOz1eikYnyLn81lGkdvtJua8j8dju9/vKjSZTOQHgAjgUCwWrdvtij56lctlMWq32ypGXK/XkwSdTseazaZiKZoCQhkQNCExjmO1QQDJ2+3WqtWq/OFwaJVKRXe0TR5x6ApbgAMCZzIZazQaViqVbDAYKJjAQqGgtnO5nBgBEEWRAAGu1+vp9MmDSODQ7/elTT6fFxgyUBVAErLZrFpm0SYyANZqtXSPnkmSaDCaMpqgD5ewwJ/P52LNMOgChhgsWOy1Wk3fiqHAUICA0TuTRVQe0IzqgMHc/x/dwIh7dtjSOjKgLzGBCgjKI1PGpyUHIhEGfBmMsxsx/n8pQutq2St6dQLdYO1GN0jBb/AhwQrNiWX/AYO4iftp8ArAAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"instrument model\" title=\"\" src=\"/static/6f2d2cab57f53c45fc61b8c6f9e68b07/fb8a0/mapping-model.png\" srcset=\"/static/6f2d2cab57f53c45fc61b8c6f9e68b07/1a291/mapping-model.png 148w,\n/static/6f2d2cab57f53c45fc61b8c6f9e68b07/2bc4a/mapping-model.png 295w,\n/static/6f2d2cab57f53c45fc61b8c6f9e68b07/fb8a0/mapping-model.png 590w,\n/static/6f2d2cab57f53c45fc61b8c6f9e68b07/526de/mapping-model.png 885w,\n/static/6f2d2cab57f53c45fc61b8c6f9e68b07/fa2eb/mapping-model.png 1180w,\n/static/6f2d2cab57f53c45fc61b8c6f9e68b07/08f6a/mapping-model.png 1770w,\n/static/6f2d2cab57f53c45fc61b8c6f9e68b07/d0903/mapping-model.png 1894w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  </span>\n  \n    <font size=\"2\">\n    <figcaption>Mapping model diagram taken from: <a href=\"http://sro.sussex.ac.uk/id/eprint/46868/1/34.4.magnusson.pdf\">http://sro.sussex.ac.uk/id/eprint/46868/1/34.4.magnusson.pdf</a>\n    </figcaption>\n  </font>\n</figure>\n<h2>Deriving the mappings in Pastelloops</h2>\n<p>In this section, we’re going to take each component described in the instrument model and try to explain how Pastelloops satisfies that constraint.</p>\n<h3>Sound engine</h3>\n<p>As of today, Pastelloops has two brushes of different colors - brown and green. Each brush is associated with a specific sound that it generates. One of them is a synthesizer with a custom set of overtones and slow attack and decay rate leading to smooth tone color. Another one is a synth loaded with grand piano samples.</p>\n<p>The sound engine in this application is powered by WebAudio API which makes it possible to function in a web browser. An amazing JS library called <a href=\"https://github.com/Tonejs/Tone.js/\">Tone.js</a> is used for implementing all the audio functionality. Tone.js, as I’ve emphasized in my previous blog posts and as emphasized by others, makes it easier to build audio applications in the browser, than by using WebAudio directly.</p>\n<p>Another library called <a href=\"https://github.com/nbrosowsky/tonejs-instruments\">Tonejs-instruments</a> is used to load grand piano samples and create an instrument node.</p>\n<p>For reference, I’m adding a snippet that shows the construction of two audio sources -</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> synth1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Tone<span class=\"token punctuation\">.</span>PolySynth</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> Tone<span class=\"token punctuation\">.</span>Synth<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  oscillator<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    type<span class=\"token punctuation\">:</span> <span class=\"token string\">'custom'</span><span class=\"token punctuation\">,</span>\n    partials<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'envelope'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'attack'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'decay'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'sustain'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'release'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0.5</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">var</span> synth2 <span class=\"token operator\">=</span> SampleLibrary<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  instruments<span class=\"token punctuation\">:</span> <span class=\"token string\">'piano'</span><span class=\"token punctuation\">,</span>\n  baseUrl<span class=\"token punctuation\">:</span> <span class=\"token string\">'https://nbrosowsky.github.io/tonejs-instruments/samples/'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Mapping engine</h3>\n<p>The sound is generated based on where the playhead intersects with the points drawn on the canvas. The color of the intersecting point decides which synth to be used for generating the sound. The pitch that is played is decided based on where on the <code class=\"language-text\">y</code> axis is that point. One thing about Pastelloops that assists the user in generating a musical output regardless of what they draw, is that all the notes that are played form a single scale. Depending on which scale is selected by the user, the range of notes <em>start from the root note of the scale in octave 1</em> and end at the <em>last note of the scale in 5th octave</em>.</p>\n<p>The following is a snippet that is used to change the scale -</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> modeIntervals <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  major<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  dorian<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  myxolydian<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  phrygian<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">switchScale</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">tone<span class=\"token punctuation\">,</span> type</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> scaleNotes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">var</span> intervals <span class=\"token operator\">=</span> modeIntervals<span class=\"token punctuation\">[</span>type<span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    scaleNotes <span class=\"token operator\">=</span> scaleNotes<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>Tone<span class=\"token punctuation\">.</span><span class=\"token function\">Frequency</span><span class=\"token punctuation\">(</span>tone <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">harmonize</span><span class=\"token punctuation\">(</span>intervals<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">f</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> f<span class=\"token punctuation\">.</span><span class=\"token function\">toNote</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>The interface</h3>\n<p>The interface looks like a very simple drawing application. Because the interface is a web application, it can open on any device with a modern browser (tested on Chrome, Firefox, and Edge) without an installation requirement.</p>\n<p>When the interface has loaded, the user can use their trackpad or mouse on a computer or their finger on a touch-enabled device to draw over the canvas. The default selected brush is used unless the user decides to change it using the buttons corresponding to each brush. The eraser button can be used to enable the erase tool which can be used to clear off specific parts of the canvas. P5.js which is a Javascript port of processing language has been used to build the sketching interface and perform all the transitions.</p>\n<p>The default selected scale is A Major which can be changed using two dropdowns - one for selecting note of the tonic center and the other for the type of scale. The foundation scale for the mapping engine changes as soon as any change happens to this selection, and the resulting music output changes based on that.</p>\n<h3>Sonic feedback</h3>\n<p>An important part of any musical instrument is the feedback that you receive when you interact with it, like hearing the sound of a guitar when you pluck a string. That is true for a digital instrument as well, and I tried to incorporate it somehow in Pastelloops.</p>\n<p>A rolling playhead scans the canvas from left to right, looking for any pixels drawn along the vertical axis at a given <code class=\"language-text\">x</code> position. </p>\n<p>While this is like a playback mechanism, it would seem lacking if there was no immediate sonic response to the drawing interaction with the canvas. To counter the lack, the playhead is moved to the place where the user decides to draw. This ends up triggering all the notes that fall along the playhead.</p>\n<h2>More possibilities on the web?</h2>\n<p>As you can see that this mapping model can help in breaking an interactive musical application into abstract components. Most often these abstract components can be changed independently to create a new overall experience. With so many capabilities on the web platform, different kinds of tweaks can be thought of and permuted in order to create new experiences . I’m using the following section for just that.</p>\n<h3>Augmenting digital UI with a physical interface</h3>\n<p>Through different web APIs in the browser, it’s already possible to interface with different devices that could act as complementary affordances to the digital music interface.</p>\n<p>There is WebMIDI API using which one can build an experience around a MIDI controller. There is WebUSB using which one can build an experience involving a wider variety of physical inputs - like different kind of sensors. Similarly, WebVR can open up all-new possibilities creating virtual worlds as interfaces to play music.</p>\n<h3>Collaborative musical experiences</h3>\n<p>Because these interfaces are designed on the web, not only they are easy to access for a user, but it’s also easy to build an application that can involve different users in the musical experience. Web APIs like WebRTC offer to build a p2p networked application, which can be used to transmit interactions. Very specifically in Pastelloops, such a capability can be used to build a collaborative sketching interface towards an experience of music jamming using sketches for friends located in different geographies.</p>\n<h3>Applying machine learning</h3>\n<p>Real instruments are interesting because there is unpredictability or noise that comes with them. The strings of a guitar get old and lead to a change in tone color. One of the reasons why guitars sound different to a varying extent which makes them kind of cool. With a digital instrument, however, no variance is introduced no matter how many times you play it. A sound signal is 100% reproducible, every time a particular interaction is repeated. That doesn’t sound as much as fun as a physical instrument. How do we incorporate noisy characteristics of a physical instrument into a repeatable musical machine and yet ensure the output is musical?</p>\n<p>With the latest research in musical applications of AI, we’ve come up with ways and means to do such things. <a href=\"https://magenta.tensorflow.org/\">Google’s Magenta project</a> has some great examples of this. What’s great? There’s a JS library that brings Magenta project in the browser which lets you build applications that help you use AI to synthesize sounds, continue of a sequence of notes or interpolate a melody between a set of melodies that you feed into the system.</p>","frontmatter":{"title":"Building a web-based musical instrument","date":"May 24, 2019"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2019/05/24/web-digital-instrument.html","previous":{"fields":{"slug":"/2019/01/31/agile-testing.html"},"frontmatter":{"title":"Notes on Agile Testing"}},"next":{"fields":{"slug":"/2019/06/29/web-digital-instrument.html"},"frontmatter":{"title":"Building a web-based musical instrument"}}}}