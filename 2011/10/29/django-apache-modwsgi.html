<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width" />
    <meta name="keywords" content="python, javascript, django, open-source, ashish dubey, mozilla, wikimedia" />
    <meta name="description" content="Ashish Dubey's Blog" />
    <title> Setting up Apache Server for Django with mod_wsgi  | Ashish Dubey's Blog</title>
    <link rel="stylesheet" href="/static/style.css" type="text/css"/>
     
  </head>
  <body>
    <div id="container">
      <div id="header">
        <div id="branding">
          <a href="/">Ashish Dubey's Blog</a>
        </div>
        <div id="nav">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/posts.html">Archive</a></li>
            <li><a href="/about.html">About</a></li>
          </ul>
        </div>
        <div style="clear: both"></div>
      </div>
      <div id="content">
  <div class="post">
    <h1>Setting up Apache Server for Django with mod_wsgi </h2>
    <div class="post-meta">
      <span class="post-date">Posted on October 29, 2011 </span>
    </div>
    <div class="post-content">
      <p>Django is a very cool web development framework which comes with its own
lightweight development server which is best for testing the application. But
when it comes to deploying the application for the outer world, more efficient
and secure web server like Apache is preferred. Now, web developers who have
been developing applications using PHP might find it very easy to deploy their
applications on Apache(as they have easy configurable PHP module, or they
could just find a LAMP stack for if they were on Linux, so they would get
everything cooked. But when it comes to combining python web frameworks like
Django with Apache, things turn out to be less obvious. My experience weren't
smooth at all while trying to get my Django project work on Apache. And since
I was trying to configure it with already installed LAMP stack on my Ubuntu
system, things went really bad. Since, there are so many things integrated in
a compilation like LAMP stack, there are as many things which can go wrong
while configuring Django on an Apache server. So, its recommended that a clean
and separate Apache installation should be used so that things are easier to
diagnose one by one.</p>

<h2>Step 1 - Install Apache HTTP Server</h2>

<p>You should install a clean build of Apache in case you haven't already. Its
easy, just follow the docs given here <a href="http://httpd.apache.org/docs/2.2/install.html">http://httpd.apache.org/docs/2.2/instal
l.html</a></p>

<h2>Step 2 - Install mod_wsgi</h2>

<p>Now that you're done with Apache, you need to install mod_wsgi which is a WSGI
module for Apache. Know more about it here.
<a href="http://code.google.com/p/modwsgi/">http://code.google.com/p/modwsgi/</a></p>

<p>Installation instructions <a href="http://code.google.com/p/modwsgi/wiki/InstallationOnLinux">http://code.google.com/p/modwsgi/wiki/InstallationO
nLinux</a> </p>

<h2>Step 3 - Load and Configure mod_wsgi in Apache config</h2>

<p>This is where you edit the Apache
configuration file and tell Apache to load mod_wsgi module using the DSO
method. You need to edit /conf/httpd.conf file and add the following directive
to it</p>

<style>.apache .hll { background-color: #ffffcc }
.apache  { background: #f0f0f0; }
.apache .c { color: #60a0b0; font-style: italic } /* Comment */
.apache .err { border: 1px solid #FF0000 } /* Error */
.apache .k { color: #007020; font-weight: bold } /* Keyword */
.apache .o { color: #666666 } /* Operator */
.apache .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.apache .cp { color: #007020 } /* Comment.Preproc */
.apache .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.apache .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.apache .gd { color: #A00000 } /* Generic.Deleted */
.apache .ge { font-style: italic } /* Generic.Emph */
.apache .gr { color: #FF0000 } /* Generic.Error */
.apache .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.apache .gi { color: #00A000 } /* Generic.Inserted */
.apache .go { color: #888888 } /* Generic.Output */
.apache .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.apache .gs { font-weight: bold } /* Generic.Strong */
.apache .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.apache .gt { color: #0044DD } /* Generic.Traceback */
.apache .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.apache .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.apache .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.apache .kp { color: #007020 } /* Keyword.Pseudo */
.apache .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.apache .kt { color: #902000 } /* Keyword.Type */
.apache .m { color: #40a070 } /* Literal.Number */
.apache .s { color: #4070a0 } /* Literal.String */
.apache .na { color: #4070a0 } /* Name.Attribute */
.apache .nb { color: #007020 } /* Name.Builtin */
.apache .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.apache .no { color: #60add5 } /* Name.Constant */
.apache .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.apache .ni { color: #d55537; font-weight: bold } /* Name.Entity */
.apache .ne { color: #007020 } /* Name.Exception */
.apache .nf { color: #06287e } /* Name.Function */
.apache .nl { color: #002070; font-weight: bold } /* Name.Label */
.apache .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.apache .nt { color: #062873; font-weight: bold } /* Name.Tag */
.apache .nv { color: #bb60d5 } /* Name.Variable */
.apache .ow { color: #007020; font-weight: bold } /* Operator.Word */
.apache .w { color: #bbbbbb } /* Text.Whitespace */
.apache .mb { color: #40a070 } /* Literal.Number.Bin */
.apache .mf { color: #40a070 } /* Literal.Number.Float */
.apache .mh { color: #40a070 } /* Literal.Number.Hex */
.apache .mi { color: #40a070 } /* Literal.Number.Integer */
.apache .mo { color: #40a070 } /* Literal.Number.Oct */
.apache .sb { color: #4070a0 } /* Literal.String.Backtick */
.apache .sc { color: #4070a0 } /* Literal.String.Char */
.apache .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.apache .s2 { color: #4070a0 } /* Literal.String.Double */
.apache .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.apache .sh { color: #4070a0 } /* Literal.String.Heredoc */
.apache .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.apache .sx { color: #c65d09 } /* Literal.String.Other */
.apache .sr { color: #235388 } /* Literal.String.Regex */
.apache .s1 { color: #4070a0 } /* Literal.String.Single */
.apache .ss { color: #517918 } /* Literal.String.Symbol */
.apache .bp { color: #007020 } /* Name.Builtin.Pseudo */
.apache .vc { color: #bb60d5 } /* Name.Variable.Class */
.apache .vg { color: #bb60d5 } /* Name.Variable.Global */
.apache .vi { color: #bb60d5 } /* Name.Variable.Instance */
.apache .il { color: #40a070 } /* Literal.Number.Integer.Long */</style><div class="apache"><pre><span class="nb">LoadModule</span> wsgi_module <span class="sx">/usr/lib/apache2/modules/mod_wsgi.so</span>
</pre></div>


<p>Also, at the end of the httpd.conf file, add the following directives</p>

<div class="apache"><pre><span class="nb">WSGIScriptAlias</span> / &lt;path-to-your-django-project&gt;/test.wsgi
<span class="nt">&lt;Directory</span> <span class="s">path-to-your-django-project</span><span class="nt">&gt;</span>
<span class="nb">Order</span> deny,allow
<span class="nb">Allow</span> from <span class="k">all</span>
<span class="nt">&lt;/Directory&gt;</span>
</pre></div>


<p>The first line in the above directives loads mod_wsgi module into the Apache
instance. The second directive <Directory> directive is there to make sure
Apache can access the directory given in the path. Also, make sure you replace
<path-to-your-django-project> with its appropriate value.</p>

<h2>Step 4 - Test WSGI</h2>

<p>Now that we've configured Apache to load the mod_wsgi module, its time to test
if it works. To do that, create a file <path-to-your-django-project>/test.wsgi
with the following content.</p>

<style>.python .hll { background-color: #ffffcc }
.python  { background: #f0f0f0; }
.python .c { color: #60a0b0; font-style: italic } /* Comment */
.python .err { border: 1px solid #FF0000 } /* Error */
.python .k { color: #007020; font-weight: bold } /* Keyword */
.python .o { color: #666666 } /* Operator */
.python .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.python .cp { color: #007020 } /* Comment.Preproc */
.python .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.python .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.python .gd { color: #A00000 } /* Generic.Deleted */
.python .ge { font-style: italic } /* Generic.Emph */
.python .gr { color: #FF0000 } /* Generic.Error */
.python .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.python .gi { color: #00A000 } /* Generic.Inserted */
.python .go { color: #888888 } /* Generic.Output */
.python .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.python .gs { font-weight: bold } /* Generic.Strong */
.python .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.python .gt { color: #0044DD } /* Generic.Traceback */
.python .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.python .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.python .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.python .kp { color: #007020 } /* Keyword.Pseudo */
.python .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.python .kt { color: #902000 } /* Keyword.Type */
.python .m { color: #40a070 } /* Literal.Number */
.python .s { color: #4070a0 } /* Literal.String */
.python .na { color: #4070a0 } /* Name.Attribute */
.python .nb { color: #007020 } /* Name.Builtin */
.python .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.python .no { color: #60add5 } /* Name.Constant */
.python .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.python .ni { color: #d55537; font-weight: bold } /* Name.Entity */
.python .ne { color: #007020 } /* Name.Exception */
.python .nf { color: #06287e } /* Name.Function */
.python .nl { color: #002070; font-weight: bold } /* Name.Label */
.python .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.python .nt { color: #062873; font-weight: bold } /* Name.Tag */
.python .nv { color: #bb60d5 } /* Name.Variable */
.python .ow { color: #007020; font-weight: bold } /* Operator.Word */
.python .w { color: #bbbbbb } /* Text.Whitespace */
.python .mb { color: #40a070 } /* Literal.Number.Bin */
.python .mf { color: #40a070 } /* Literal.Number.Float */
.python .mh { color: #40a070 } /* Literal.Number.Hex */
.python .mi { color: #40a070 } /* Literal.Number.Integer */
.python .mo { color: #40a070 } /* Literal.Number.Oct */
.python .sb { color: #4070a0 } /* Literal.String.Backtick */
.python .sc { color: #4070a0 } /* Literal.String.Char */
.python .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.python .s2 { color: #4070a0 } /* Literal.String.Double */
.python .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.python .sh { color: #4070a0 } /* Literal.String.Heredoc */
.python .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.python .sx { color: #c65d09 } /* Literal.String.Other */
.python .sr { color: #235388 } /* Literal.String.Regex */
.python .s1 { color: #4070a0 } /* Literal.String.Single */
.python .ss { color: #517918 } /* Literal.String.Symbol */
.python .bp { color: #007020 } /* Name.Builtin.Pseudo */
.python .vc { color: #bb60d5 } /* Name.Variable.Class */
.python .vg { color: #bb60d5 } /* Name.Variable.Global */
.python .vi { color: #bb60d5 } /* Name.Variable.Instance */
.python .il { color: #40a070 } /* Literal.Number.Integer.Long */</style><div class="python"><pre><span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&#39;200 OK&#39;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s">&#39;Hello World!&#39;</span>
    <span class="n">response_headers</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s">&#39;text/plain&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;Content-Length&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)))]</span>
    <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">output</span><span class="p">]</span>
</pre></div>


<p>Now test if it works by trying http://localhost in your browser, you should
get Hello World for obvious reasons.(and yes make sure Apache is running)</p>

<h2>Step 5 - Test the bad WSGI</h2>

<p>Now, that the simple WSGI application runs, we need to test something which
generally has issues which need to be resolved before moving on to using
Django as a WSGI application.</p>

<h3><strong>The Expat woe</strong></h3>

<p>When we move to more complicated WSGI applications, and as the applications
start using libraries whose versions conflict with the versions used by
Apache, there are issues like Apache crashing and incorrect response. One such
library is libexpat. Know more about it here <a href="http://expat.sourceforge.net/">http://expat.sourceforge.net/</a>.</p>

<p>It happens in many situations that the expat module used by python(that is the
default one on a system) has a different version than that used by Apache(it
has its own). In such a situation, there is Segmentation Fault encountered by
Apache and it crashes. To test it if you encounter that issue, just make the
following entry in your test.wsgi file.</p>

<div class="python"><pre><span class="kn">import</span> <span class="nn">pyexpat</span>
</pre></div>


<p>Now, again try http://localhost. If you get proper response as earlier then
you are free from the expat issue while if you get 'no response' error then
you need to resolve the expat issue before turning on to Django.</p>

<h3><strong>Resolving Expat Issue</strong></h3>

<p>There is this great post on handling expat issue. <a href="http://code.google.com/p/modwsgi/wiki/Issues
WithExpatLibrary">http://code.google.com/p/mod
wsgi/wiki/IssuesWithExpatLibrary</a>.</p>

<p>Since, python's expat module is hard to replace, its
recommended you change Apache's expat module. Either update it or simply
replace it with your system's expat. I consider replacing it. After all done,
restart Apache and test http://localhost, if all went good it should be
working fine.</p>

<h2>Step 6 - Configure WSGI for Django</h2>

<p>If you've successfully dealt with running WSGI with expat loaded, you should
then be able to run Django after a little bit of work if not-so-common issues
don't fall in your way. For connecting to Django with mod_wsgi, you should
create a new django.wsgi in the same directory as test.wsgi and set
WSGIScriptAlias to that very file. Enter the following code to django.wsgi and
you're on the go.</p>

<div class="python"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span><span class="s">&#39;..&#39;</span><span class="p">)</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">root</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;&lt;your-project&gt;.settings&#39;</span>

<span class="kn">import</span> <span class="nn">django.core.handlers.wsgi</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">django</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIHandler</span><span class="p">()</span>
</pre></div>


<p>Replace <code>&lt;your-project&gt;</code> with your project's name. </p>

<h2>Step 7 - Test Django</h2>

<p>So you've worked out all the way to the point where you would need to test if all
your setup works fine. Its recommended that you use a clean Django application
so that you don't encounter issues related to database and other stuff.</p>

    </div>
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'ashishdubeysblog'; // required: replace example with your forum shortname
     // var disqus_developer = 1

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="https://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
      <div id="footer">
	    <div>
          <p>Copyright &copy 2015 Ashish Dubey</p>
          <p>Licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike License</a></p>
        </div>
      </div>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-24206813-4', 'dash1291.github.io');
      ga('send', 'pageview');

    </script>
  </body>
</html>